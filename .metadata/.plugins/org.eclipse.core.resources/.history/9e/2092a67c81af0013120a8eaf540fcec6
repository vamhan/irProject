package controller;
import java.io.BufferedReader;
import java.io.InputStreamReader;

import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;
import org.json.JSONObject;

import com.hp.hpl.jena.query.QueryExecution;
import com.hp.hpl.jena.query.QueryExecutionFactory;
import com.hp.hpl.jena.sparql.engine.http.QueryExceptionHTTP;

public class DBPediaRequest {

	static HttpClient client;
	
	public static JSONObject getResult(String keyword) {
		try {
			if (client == null) {
				client = new DefaultHttpClient();
			}
			String getURL = "http://lookup.dbpedia.org/api/search/KeywordSearch?QueryString=" + keyword;
			HttpGet get = new HttpGet(getURL);
			get.setHeader("Accept", "application/json");
			HttpResponse responseGet = client.execute(get);
			BufferedReader rd = new BufferedReader(new InputStreamReader(
					responseGet.getEntity().getContent()));
	
			StringBuffer result = new StringBuffer();
			String line = "";
			while ((line = rd.readLine()) != null) {
				result.append(line);
			}
	
			JSONObject o = new JSONObject(result.toString());
			
			rd.close();
			get.abort();
			
			String service = "http://dbpedia.org/sparql";
	        String query = "ASK { }";
	        QueryExecution qe = QueryExecutionFactory.sparqlService(service, query);
	        try {
	            if (qe.execAsk()) {
	                System.out.println(service + " is UP");
	            } // end if
	        } catch (QueryExceptionHTTP e) {
	            System.out.println(service + " is DOWN");
	        } finally {
	            qe.close();
	        } // end try/catch/finally
			
			return o;
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		}

	}
}
